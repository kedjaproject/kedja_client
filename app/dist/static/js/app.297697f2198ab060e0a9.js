webpackJsonp([1],{"13nz":function(t,e){},"1fAO":function(t,e){},"3/Hr":function(t,e){},"3ljf":function(t,e){},"4Wh8":function(t,e){},"4k5+":function(t,e){},FfLK:function(t,e){},FqKH:function(t,e){},I78t:function(t,e){},J8Ti:function(t,e){},LYl2:function(t,e){},NHnr:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("7+uW"),a=n("Dd8w"),o=n.n(a),r=n("NYxO"),s={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"KedjaLogo"},[e("router-link",{attrs:{to:{name:"Home",params:{}}}},[this._v("\n    KEDJA.\n  ")])],1)},staticRenderFns:[]};var c=n("VU/8")({name:"KedjaLogo",data:function(){return{}},props:{},computed:{},methods:{},mounted:function(){}},s,!1,function(t){n("v0MC")},"data-v-3b28c041",null).exports,l={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"DropDown",attrs:{tabindex:"0"},on:{blur:function(e){return t.blur(e)}}},[n("div",{staticClass:"toggle",on:{click:t.toggleList}},[t._t("default")],2),t._v(" "),n("div",{staticClass:"listContainer z2",attrs:{tabindex:"0"}},[n("div",{staticClass:"list",class:{open:t.open},attrs:{tabindex:"0"}},t._l(t.items,function(e,i){return n("div",{key:i,staticClass:"listItem",attrs:{tabindex:"0"},on:{click:function(n){return t.performFunction(e.f)}}},[t._v("\n        "+t._s(e.label)+"\n      ")])}),0)])])},staticRenderFns:[]};var d=n("VU/8")({name:"DropDown",data:function(){return{open:!1}},props:{items:""},computed:{},methods:{toggleList:function(){this.open=!this.open},close:function(){this.open=!1},blur:function(t){this.$el.contains(t.relatedTarget)||this.close()},performFunction:function(t){t&&t()}},mounted:function(){}},l,!1,function(t){n("3ljf")},"data-v-b2d7038c",null).exports,u=n("//Fk"),f=n.n(u),m=n("mtWM"),h=n.n(m),v=new i.a,g=h.a.create({baseURL:"https://staging-server.kedja.org/api/1/",headers:{Authorization:localStorage.auth}});g.interceptors.response.use(function(t){return t},function(t){return f.a.reject(t)});var p={name:"KedjaHeader",components:{KedjaLogo:c,DropDown:d},data:function(){return{}},props:{},computed:o()({},Object(r.c)(["isAuthenticated"]),Object(r.c)("users",["currentUser"]),Object(r.e)(["userState"])),methods:{goToProfile:function(t){this.$router.push({name:"Profile"})},goToWalls:function(t){this.$router.push({name:"Walls"})},logout:function(t){var e=this;g.post("auth/logout").then(function(t){e.$store.dispatch("logout"),e.$router.push({name:"Login"})})}},mounted:function(){}},C={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"KedjaHeader"},[n("kedja-logo"),t._v(" "),n("div",{staticClass:"slot"},[t._t("default")],2),t._v(" "),n("div",{staticClass:"user"},[t.isAuthenticated?n("div",[n("drop-down",{attrs:{items:[{label:"Min profil",f:t.goToProfile},{label:"Mina väggar",f:t.goToWalls},{label:"Logga ut",f:t.logout}]}},[n("div",{staticClass:"right"},[t.currentUser.shortName?n("span",[t._v(t._s(t.currentUser.shortName))]):n("span",[t._v("Inloggad användare")])])])],1):t._e()])],1)},staticRenderFns:[]};var w=n("VU/8")(p,C,!1,function(t){n("SPHx")},"data-v-b2729cfa",null).exports,b={render:function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"KedjaHeader"})},staticRenderFns:[]};var _={name:"App",components:{KedjaHeader:w,KedjaFooter:n("VU/8")({name:"KedjaHeader",data:function(){return{}},props:{},computed:{},methods:{},mounted:function(){}},b,!1,function(t){n("13nz")},"data-v-29106db2",null).exports},data:function(){return{env:Object({NODE_ENV:"production",API_SERVER:"https://staging-server.kedja.org",API_PATH:"/api/1/"})}},created:function(){this.$store.commit("init",{env:this.env}),this.$store.commit("resetUserState"),this.authenticate()},mounted:function(){document.activeElement.blur()},methods:o()({},Object(r.b)(["authenticate"]))},k={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("router-view",{attrs:{id:"router"}}),this._v(" "),e("kedja-footer",{attrs:{id:"footer"}})],1)},staticRenderFns:[]};var y=n("VU/8")(_,k,!1,function(t){n("LYl2")},null,null).exports,I=n("/ocq"),E={name:"ViewHome",components:{KedjaHeader:w},data:function(){return{}},props:{},computed:o()({},Object(r.c)(["isAuthenticated"])),methods:{loggedIn:function(){this.isAuthenticated?this.$router.push({name:"Walls"}):this.$router.push({name:"Login"})}},created:function(){this.loggedIn()},mounted:function(){}},x={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"ViewHome"},[e("kedja-header"),this._v(" "),e("div",{staticClass:"viewContent"},[this._v("\n    HEM\n  ")])],1)},staticRenderFns:[]};var $=n("VU/8")(E,x,!1,function(t){n("Sk8g")},"data-v-207a6e2e",null).exports,D={name:"ViewLogin",components:{KedjaHeader:w},data:function(){return{email:"",pass:"",methods:""}},props:{},computed:o()({},Object(r.c)(["isAuthenticated"])),methods:{loginUrl:function(t){return t.url+"?came_from="+window.location.origin},getLoginMethods:function(){var t=this;g.get("auth/methods").then(function(e){t.methods=e.data})},loggedIn:function(){this.isAuthenticated&&this.$router.push({name:"Home"})}},created:function(){this.loggedIn()},mounted:function(){this.getLoginMethods()}},S={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"ViewLogin"},[n("kedja-header"),t._v(" "),n("div",{staticClass:"viewContent"},[n("h1",[t._v("\n      KEDJA.\n    ")]),t._v(" "),n("h3",[t._v("Logga in / Registrera nytt konto med")]),t._v(" "),t._l(t.methods,function(e,i){return n("h2",{key:i},[n("a",{attrs:{href:t.loginUrl(e)}},[t._v(t._s(e.title))])])})],2)],1)},staticRenderFns:[]};var W=n("VU/8")(D,S,!1,function(t){n("I78t")},"data-v-b42a63f8",null).exports,U={name:"ViewLoggingIn",components:{KedjaHeader:w},data:function(){return{}},props:{},computed:{auth:function(){return this.$store.getters.getAuth},userid:function(){return this.$route.query.u},token:function(){return this.$route.query.t}},methods:{login:function(){var t=this;g.post("auth/credentials/"+this.userid+"/"+this.token).then(function(e){console.log(e),t.$store.dispatch("login",e.data),t.$router.push({name:"Home"})})}},created:function(){},mounted:function(){this.login()}},j={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"ViewLoggingIn"},[e("kedja-header"),this._v(" "),e("div",{staticClass:"viewContent"},[this._v("\n    Du loggas in.\n  ")])],1)},staticRenderFns:[]};var A=n("VU/8")(U,j,!1,function(t){n("4k5+")},"data-v-2b912576",null).exports,O={name:"ViewRegister",components:{KedjaHeader:w},data:function(){return{}},props:{},computed:{registerToken:function(){return this.$route.query.t}},methods:{register:function(){var t=this,e={endpoint:"auth/register/"+this.registerToken,method:"post",successCallback:function(e){console.log(e),t.$store.dispatch("login",{auth:e.data.Authorization,userid:e.data.userid,first_name:e.data.user.data.first_name,last_name:e.data.user.data.last_name}),t.$router.push({name:"Home"})}};this.$store.commit("makeAPICall",e)}},created:function(){},mounted:function(){}},B={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"ViewRegister"},[n("kedja-header"),t._v(" "),n("div",{staticClass:"viewContent"},[n("h2",[t._v("Registrera nytt konto")]),t._v(" "),n("p",[t._v("\n      Du behöver registrera ett konto på Kedja för att fortsätta inloggningen.\n    ")]),t._v(" "),t._m(0),t._v(" "),n("form",{on:{submit:function(e){return e.preventDefault(),t.register(e)}}},[t._m(1),t._v(" "),n("button",{attrs:{type:"submit"}},[t._v("Sälj min själ")])])])],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("a",{attrs:{href:""}},[this._v("Läs användaravtal")]),this._v(" för registrering och användning av Kedja.\n    ")])},function(){var t=this.$createElement,e=this._self._c||t;return e("label",[e("input",{attrs:{type:"checkbox"}}),this._v(" Jag går med på allt.\n      ")])}]};var R=n("VU/8")(O,B,!1,function(t){n("3/Hr")},"data-v-db334b12",null).exports,L={name:"ViewProfile",components:{KedjaHeader:w},data:function(){return{userDataEditable:{}}},props:{},computed:o()({},Object(r.c)("users",["currentUser"]),Object(r.e)("users",["currentUserId"])),methods:o()({},Object(r.d)("users",["setUserData"]),Object(r.b)("users",["fetchUserData"]),{setDataEditable:function(t){this.userDataEditable={first_name:t.first_name,last_name:t.last_name}},updateProfile:function(){var t=this;g.put("users/"+this.currentUserId,this.userDataEditable).then(function(e){t.setUserData(e.data),t.setDataEditable(e.data.data)})}}),created:function(){this.setDataEditable(this.currentUser)},mounted:function(){}},T={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"ViewProfile"},[n("kedja-header"),t._v(" "),n("div",{staticClass:"viewContent"},[t._v("\n    Du är inloggad som\n\n    "),n("h2",[t._v("\n      "+t._s(t.currentUser.fullName)+"\n    ")]),t._v(" "),n("h3",[t._v("Uppdatera profil")]),t._v(" "),n("form",{on:{submit:function(e){return e.preventDefault(),t.updateProfile(e)}}},[n("label",[n("input",{directives:[{name:"model",rawName:"v-model",value:t.userDataEditable.first_name,expression:"userDataEditable.first_name"}],attrs:{type:"text",placeholder:"Förnamn"},domProps:{value:t.userDataEditable.first_name},on:{input:function(e){e.target.composing||t.$set(t.userDataEditable,"first_name",e.target.value)}}})]),t._v(" "),n("label",[n("input",{directives:[{name:"model",rawName:"v-model",value:t.userDataEditable.last_name,expression:"userDataEditable.last_name"}],attrs:{type:"text",placeholder:"Efternamn"},domProps:{value:t.userDataEditable.last_name},on:{input:function(e){e.target.composing||t.$set(t.userDataEditable,"last_name",e.target.value)}}})]),t._v(" "),n("button",{attrs:{type:"submit"}},[t._v("Spara ändringar")])])])],1)},staticRenderFns:[]};var V=n("VU/8")(L,T,!1,function(t){n("FfLK")},"data-v-281fdd61",null).exports,F={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"RouterLinkBox",style:{"background-color":this.color}},[e("router-link",{staticClass:"link",attrs:{to:this.to}},[this._t("default")],2)],1)},staticRenderFns:[]};var N={name:"ViewWallList",components:{KedjaHeader:w,RouterLinkBox:n("VU/8")({name:"RouterLinkBox",data:function(){return{}},props:{text:"",color:"",to:""},computed:{},methods:{},mounted:function(){}},F,!1,function(t){n("FqKH")},"data-v-3f599614",null).exports},computed:o()({},Object(r.c)("walls",["all"])),methods:o()({},Object(r.b)("walls",["fetchWalls","createWall"])),mounted:function(){this.fetchWalls()}},K={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"ViewWallList"},[n("kedja-header",[n("button",{on:{click:t.createWall}},[t._v("\n      + Ny vägg\n    ")])]),t._v(" "),n("h3",[t._v("Mina väggar")]),t._v(" "),n("div",{staticClass:"wallBoxes"},t._l(t.all,function(e){return n("router-link-box",{key:e.rid,staticClass:"wallBox",attrs:{to:{name:"ViewWall",params:{wallId:e.rid}},color:"lightsteelblue"}},[n("h3",[t._v("\n        "+t._s(e.data.title)+"\n      ")])])}),1)],1)},staticRenderFns:[]};var P=n("VU/8")(N,K,!1,function(t){n("UYur")},"data-v-7a0f84c8",null).exports,H={name:"WrapperComponent",render:function(t){return t(this.tag,this.$slots.default)},props:{tag:{type:String,required:!0}}},J={name:"EditableInput",components:{WrapperComponent:n("VU/8")(H,null,!1,null,null,null).exports},props:{value:"",tag:"",placeholder:{default:"Ange text"},type:{default:"textarea"},focus:!1,locked:!1},data:function(){return{editing:!1,textTemp:"",width:"",height:"auto"}},computed:{inputVisible:function(){return this.editing||""===this.value}},watch:{},methods:{openEdit:function(){this.locked||(console.log("Open edit"),this.calcWidth(),this.editing=!0,this.textTemp=this.value,this.$nextTick(function(t){this.$refs.input.focus(),this.$refs.input.select()}))},initEdit:function(){},clearTemp:function(){this.textTemp=""},onInitEdit:function(){this.$emit("init-edit")},cancel:function(){this.editing=!1,this.$emit("cancel")},onBlur:function(){this.editing&&this.finishEdit(!0)},finishEdit:function(t){console.log("Färdigskriven: "+this.editing+" "+t),this.editing&&t&&(this.editing=!1,this.emitToParent())},calcWidth:function(){this.$nextTick(function(){var t=this.$el.getElementsByClassName("textSpan")[0];t&&(this.width=t.offsetWidth+"px",this.height=t.offsetHeight+"px")})},emitToParent:function(){this.$emit("input",this.textTemp),this.$emit("change",this.textTemp)}},mounted:function(){this.focus&&this.openEdit()}},M={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"EditableInput",class:{fullWidth:t.inputVisible,locked:t.locked},on:{click:t.openEdit}},[n("wrapper-component",{staticClass:"text",attrs:{tag:t.tag,id:"eiTemp"}},[t.inputVisible?t._e():n("div",{staticClass:"textContainer",on:{click:function(e){return t.openEdit()}}},[n("span",{staticClass:"textSpan"},[t._v("\n        "+t._s(t.value)+"\n      ")])]),t._v(" "),t.inputVisible?n("div",["input"==t.type?n("input",{directives:[{name:"model",rawName:"v-model",value:t.textTemp,expression:"textTemp"}],ref:"input",style:{height:t.height+"px"},attrs:{placeholder:t.placeholder},domProps:{value:t.textTemp},on:{keydown:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"esc",27,e.key,["Esc","Escape"])?null:t.cancel(e)},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.finishEdit(!0)}],blur:t.onBlur,focus:function(e){return t.onInitEdit()},input:function(e){e.target.composing||(t.textTemp=e.target.value)}}}):t._e(),t._v(" "),"textarea"==t.type?n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.textTemp,expression:"textTemp"}],ref:"input",style:{width:"100%",height:t.height},attrs:{placeholder:t.placeholder},domProps:{value:t.textTemp},on:{keydown:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.finishEdit(!0))},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"esc",27,e.key,["Esc","Escape"])?null:t.cancel(e)}],blur:t.onBlur,focus:function(e){return t.onInitEdit()},change:t.calcWidth,input:function(e){e.target.composing||(t.textTemp=e.target.value)}}}):t._e()]):t._e()])],1)},staticRenderFns:[]};var z=n("VU/8")(J,M,!1,function(t){n("n+6D")},"data-v-0e4136b1",null).exports,q={render:function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"CardButton",class:{active:this.active,placeholder:this.placeholder}},[this._t("default")],2)},staticRenderFns:[]};var Y=n("VU/8")({name:"CardButton",data:function(){return{}},props:{active:!1,placeholder:!1},computed:{},methods:{},mounted:function(){}},q,!1,function(t){n("1fAO")},"data-v-779fce5c",null).exports,Z={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"Indicator",on:{click:function(e){return t.onclick(e)}}},[n("img",{attrs:{src:t.image,alt:"Indikator"}})])},staticRenderFns:[]};var Q=n("VU/8")({name:"Indicator",data:function(){return{}},props:{value:"",min:{default:-1},max:{default:2},selected:!1},computed:{image:function(){var t="";return-1===this.value?t+=this.selected?"KEDJA_Indikator, steg 0, markerat kort":"KEDJA_Indikator, steg 0, ej markerat kort":0===this.value?t+=this.selected?"KEDJA_Indikator, steg 1, markerat kort":"KEDJA_Indikator, steg 1, ej markerat kort":1===this.value?t+=this.selected?"KEDJA_Indikator, steg 2, markerat kort":"KEDJA_Indikator, steg 2, ej markerat kort":2===this.value&&(t+=this.selected?"KEDJA_Indikator, steg 3, markerat kort":"KEDJA_Indikator, steg 3, ej markerat kort"),"/static/graphics/icons/indicator/"+(t+=".png")}},methods:{emitChangedValue:function(t){this.$emit("change",t)},onclick:function(t){this.selected&&(t.stopPropagation(),this.increaseValue())},increaseValue:function(){var t=this.value+1;t>this.max&&(t=this.min),this.$emit("input",t),this.emitChangedValue(t)}},mounted:function(){}},Z,!1,function(t){n("ZJjC")},"data-v-11cea974",null).exports,X={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"WidgetIcon",on:{mouseover:function(e){return t.setHovering(!0)},mouseout:function(e){return t.setHovering(!1)}}},[n("img",{attrs:{src:t.image,alt:"Koppla kort"}})])},staticRenderFns:[]};var G=n("VU/8")({name:"WidgetIcon",data:function(){return{hovering:!1}},props:{active:!1,path:"",img:"",imgHover:"",imgActive:""},computed:{image:function(){var t="";return t=this.active?this.imgActive:this.hovering?this.imgHover:this.img,this.path+t}},methods:{setHovering:function(t){this.hovering=t}},mounted:function(){}},X,!1,function(t){n("J8Ti")},"data-v-320a5bfc",null).exports,tt={name:"Card",components:{EditableInput:z,CardButton:Y,Indicator:Q,WidgetIcon:G,DropDown:d},data:function(){return{initiated:!1}},props:{card:Object,prid:Number},computed:o()({connectionsDirect:function(){return this.getDirectConnectionsByCardId(this.card.rid)},connectionsDeep:function(){return this.getDeepConnectionsByCardId(this.card.rid)},directConnectedCardIds:function(){var t=this,e=[];return this.connectionsDirect.forEach(function(n,i){n.members[0]!==t.card.rid&&-1===e.indexOf(n.members[0])&&e.push(n.members[0]),n.members[1]!==t.card.rid&&-1===e.indexOf(n.members[1])&&e.push(n.members[1])}),e},deepConnectedCardIds:function(){var t=this,e=[];return this.connectionsDeep.forEach(function(n,i){n.members[0]!==t.card.rid&&-1===e.indexOf(n.members[0])&&e.push(n.members[0]),n.members[1]!==t.card.rid&&-1===e.indexOf(n.members[1])&&e.push(n.members[1])}),e},indicatorValue:function(){return this.card.data.int_indicator},removeVisible:function(){return this.card.states.selected},titleLocked:function(){return"connectCard"===this.userState.name},filtered:function(){return!this.filterCards||"default"===this.userState.name||("selectCard"!==this.userState.name||(this.card.states.selected||this.card.states.selectingConnected))}},Object(r.c)("walls",["getDeepConnectionsByCardId","getDirectConnectionsByCardId","getClosestCardCousins"]),Object(r.e)("walls/cards",["cards"]),Object(r.e)(["userState"]),Object(r.e)(["filterCards"])),watch:{userState:{deep:!0,handler:function(t){(this.resetStates(),"selectCard"===t.name&&(t.data.rid===this.card.rid?this.setState("selected",!0):-1!==this.deepConnectedCardIds.indexOf(t.data.rid)?this.setState("selectingConnected",!0):this.setState("selectingNotConnected",!0)),"connectCard"===t.name)&&(t.data.rid===this.card.rid?(this.setState("selected",!0),this.setState("connecting",!0)):this.directConnectedCardIds.includes(t.data.rid)?this.setState("connectingConnected",!0):this.getClosestCardCousins(this.card).find(function(e){return e.rid===t.data.rid})?this.setState("connectingNotConnected",!0):this.setState("connectingCantConnect",!0))}}},methods:o()({setState:function(t,e){var n={rid:this.card.rid,stateName:t,stateFlag:e};this.$store.commit("walls/cards/setCardState",n)},resetStates:function(){var t={rid:this.card.rid};this.$store.commit("walls/cards/resetCardStates",t)},resetState:function(t){var e={rid:this.card.rid,stateName:t};this.$store.commit("walls/cards/setCardState",e)},clicked:function(){"connectCard"!==this.userState.name&&this.setSelected(),this.card.states.connecting&&this.setSelected(),this.card.states.connectingNotConnected&&this.connect(),this.card.states.connectingConnected&&this.unconnect()},scrollIntoView:function(){},setSelected:function(t){"selectCard"!==this.userState.name||this.userState.data.rid!==this.card.rid?this.$store.commit("setUserState",{name:"selectCard",data:{rid:this.card.rid}}):this.$store.commit("resetUserState")},toggleConnecting:function(){this.card.states.connecting?this.$store.commit("setUserState",{name:"selectCard",data:{rid:this.card.rid}}):this.$store.commit("setUserState",{name:"connectCard",data:{rid:this.card.rid}})},connect:function(){var t=this.cards[this.userState.data.rid];console.log("Connect",t),this.$emit("connect",{members:[t.rid,this.card.rid]})},unconnect:function(){var t=this.cards[this.userState.data.rid];console.log("Unconnect",t),this.$emit("unconnect",{members:[t.rid,this.card.rid]})},initUpdateTitle:function(){console.log("Börja byt namn på kort"),this.$store.commit("setUserState",{name:"renameCard",data:{rid:this.card.rid}})},updateTitle:function(t){g.put("collections/"+this.prid+"/cards/"+this.card.rid,{title:t}).then(function(t){return console.log(t)})},updateIndicatorValue:function(t){g.put("collections/"+this.prid+"/cards/"+this.card.rid,{int_indicator:t}).then(function(t){})},setFocus:function(){this.$el.focus()}},Object(r.b)("walls/collections",["removeCard"])),created:function(){},mounted:function(){}},et={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.filtered?n("div",{staticClass:"Card",class:{selected:t.card.states.selected,selectingConnected:t.card.states.selectingConnected,selectingNotConnected:t.card.states.selectingNotConnected,selectedConnectedOther:0==t.card.states.selectedConnected,connectingConnected:t.card.states.connectingConnected,connectingNotConnected:t.card.states.connectingNotConnected,connectingCantConnect:t.card.states.connectingCantConnect,cannotConnect:!this.card.states.canConnect&&!this.card.states.connecting,connectedOther:0==t.card.states.connected,connecting:this.card.states.connecting},on:{click:function(e){e.stopPropagation(),t.clicked(),t.scrollIntoView()},keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"])?null:e.target!==e.currentTarget?null:t.removeCard(e)}}},[n("div",{staticClass:"top"},[n("indicator",{attrs:{selected:t.card.states.selected},on:{change:t.updateIndicatorValue,click:function(t){t.stopPropagation()}},model:{value:t.card.data.int_indicator,callback:function(e){t.$set(t.card.data,"int_indicator",e)},expression:"card.data.int_indicator"}}),t._v(" "),n("card-button",{nativeOn:{click:function(e){e.stopPropagation(),t.toggleConnecting(),t.scrollIntoView()}}},[n("widget-icon",{attrs:{path:"/static/graphics/icons/link/",img:"KEDJA_Koppling.png",imgHover:"KEDJA_Koppling, hover.png",imgActive:"KEDJA_Koppling, igang.png",active:t.card.states.connecting}})],1)],1),t._v(" "),n("div",{staticClass:"main"},[n("EditableInput",{staticClass:"indicator",attrs:{tag:"h3",placeholder:"Namnge kort",locked:t.titleLocked},on:{change:function(e){return t.updateTitle(e)},"init-edit":t.initUpdateTitle,click:function(t){t.stopPropagation()}},model:{value:t.card.data.title,callback:function(e){t.$set(t.card.data,"title",e)},expression:"card.data.title"}})],1),t._v(" "),n("div",{staticClass:"bottom"},[t.removeVisible?n("card-button",{nativeOn:{click:function(e){return e.stopPropagation(),t.removeCard(t.card)}}},[n("widget-icon",{attrs:{path:"/static/graphics/icons/bin/",img:"KEDJA_Papperskorg.png",imgHover:"KEDJA_Papperskorg, hover.png"}})],1):t._e()],1)]):t._e()},staticRenderFns:[]};var nt=n("VU/8")(tt,et,!1,function(t){n("p4Ut")},"data-v-7be40338",null).exports,it={name:"CardSeed",components:{EditableInput:z},data:function(){return{title:""}},props:{},computed:o()({},Object(r.e)(["userState"])),watch:{},methods:{updateTitle:function(t){this.title="",t?this.$emit("create",t):this.cancel()},cancel:function(){this.$refs.editinput.clearTemp(),this.$emit("cancel")},setFocus:function(){this.$refs.editinput.openEdit()}},created:function(){},mounted:function(){}},at={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"CardSeed"},[n("div",{staticClass:"main"},[n("EditableInput",{ref:"editinput",attrs:{tag:"h3",placeholder:"Namnge kort"},on:{change:function(e){return t.updateTitle(e)},cancel:t.cancel},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}})],1)])},staticRenderFns:[]};var ot={name:"Collection",components:{DropDown:d,Card:nt,CardSeed:n("VU/8")(it,at,!1,function(t){n("4Wh8")},"data-v-3dcd1db8",null).exports,EditableInput:z,CardButton:Y,WidgetIcon:G},data:function(){return{hovering:!1,showCardSeed:!1}},computed:o()({cards:function(){return this.getList(this.collection.cardList)},cardsFiltered:function(){return"default"===this.userState.name?this.cards:(this.userState.name,this.cards)},newDisabled:function(){return"connectCard"===this.userState.name}},Object(r.c)("walls/cards",["getList"]),Object(r.c)("walls/cards",["getCardsByState"]),Object(r.e)(["userState"]),Object(r.e)(["filterCards"])),props:{collection:Object,prid:Number,wall:Object},watch:{userState:function(t){var e=this;"selectCard"===t.name&&this.$nextTick(function(){var t=e.$el.getElementsByClassName("selected");0===t.length&&(t=e.$el.getElementsByClassName("selectingConnected")),t.length>0&&e.$refs.collectionContent.scrollTo({top:t[0].offsetTop-10,behavior:"smooth"})})}},methods:o()({removeCollection:function(){this.$store.dispatch("walls/collections/removeCollection",{wall:this.wall,collection:this.collection})},initCreateCard:function(){this.showCardSeed=!0,this.$nextTick(function(t){this.$refs.cardSeed.setFocus()})},createCard:function(t){var e=this;this.createCardInCollection({collection:this.collection,title:t}).then(function(){document.activeElement.blur(),e.initCreateCard()})},cancelCardSeed:function(){this.showCardSeed=!1},updateTitle:function(t){g.put("walls/"+this.collection.rid+"/collections/"+this.collection.rid,{title:t}).then(function(t){console.log(t)})},connect:function(t){this.$emit("connect",t)},unconnect:function(t){this.$emit("unconnect",t)},handleScroll:function(){this.$store.commit("setDirtyDraw")}},Object(r.b)("walls/collections",["createCardInCollection"])),created:function(){this.$store.commit("initCollection",this.collection)},mounted:function(){this.$refs.collectionContent.addEventListener("scroll",this.handleScroll)}},rt={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"Collection"},[n("div",{staticClass:"collectionHeader z1"},[n("span"),t._v(" "),n("EditableInput",{attrs:{tag:"h2"},on:{change:function(e){return t.updateTitle(e)}},model:{value:t.collection.data.title,callback:function(e){t.$set(t.collection.data,"title",e)},expression:"collection.data.title"}}),t._v(" "),n("drop-down",{attrs:{items:[{label:"Radera samling",f:t.removeCollection}]}},[n("card-button",[n("widget-icon",{attrs:{path:"/static/graphics/icons/dropdown/",img:"KEDJA-14.png",imgHover:"KEDJA-15.png"}})],1)],1)],1),t._v(" "),n("div",{ref:"collectionContent",staticClass:"collectionContent"},[t._l(t.cards,function(e){return n("card",{key:e.rid,attrs:{card:e,id:e.rid,prid:t.collection.rid,tabindex:"0"},on:{connect:t.connect,unconnect:t.unconnect}})}),t._v(" "),n("transition",{attrs:{name:"fade",mode:"out-in"}},[t.showCardSeed?n("card-seed",{ref:"cardSeed",attrs:{tabindex:"0"},on:{create:t.createCard,cancel:t.cancelCardSeed}}):t._e()],1)],2),t._v(" "),n("div",{staticClass:"collectionFooter z1"},[n("button",{staticClass:"fullWidth",attrs:{title:"Lägg till nytt kort",disabled:t.newDisabled},on:{click:t.initCreateCard}},[t._v("+ Nytt kort")])])])},staticRenderFns:[]};var st={name:"Collections",components:{Collection:n("VU/8")(ot,rt,!1,function(t){n("NtAT")},"data-v-b6647d1a",null).exports},props:{collections:Array,prid:Number,wall:Object},computed:{dirtyDraw:function(){return this.$store.state.dirtyDraw}},watch:{},methods:o()({connect:function(t){this.$emit("connect",t)},unconnect:function(t){this.$emit("unconnect",t)}},Object(r.b)("walls/collections",["createCollection","removeCollection"])),created:function(){},mounted:function(){this.$emit("mounted")}},ct={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"collections",staticClass:"Collections"},[t._l(t.collections,function(e){return n("collection",{key:e.rid,staticClass:"collection",attrs:{collection:e,wall:t.wall,prid:t.prid},on:{connect:t.connect,unconnect:t.unconnect}})}),t._v(" "),n("div",{staticClass:"newCollection",attrs:{tabindex:"0"},on:{click:function(e){return t.createCollection(t.wall)}}},[n("button",{staticClass:"new",attrs:{title:"Lägg till ny samling"}},[t._v("+")])])],2)},staticRenderFns:[]};var lt=n("VU/8")(st,ct,!1,function(t){n("fWSD")},"data-v-0e6c50ab",null).exports,dt={name:"Connections",data:function(){return{loaded:!1,bounds:{},scroll:{}}},props:{connections:Array,boundsElementId:String},computed:o()({connectionCards:function(){var t=this;return this.connections.map(function(e){return{members:[t.cards[e.members[0]],t.cards[e.members[1]]]}})}},Object(r.e)("walls/cards",["cards"]),Object(r.e)(["userState","dirtyDraw"])),watch:{dirtyDraw:function(t){this.redraw()}},methods:{firstDraw:function(){document.getElementById(this.boundsElementId)?this.$store.commit("setDirtyDraw"):this.$nextTick(this.firstDraw)},redraw:function(){this.setBounds(),this.drawCanvas()},setBounds:function(){var t=this.$el.getElementsByTagName("canvas")[0];t.width=this.$el.clientWidth,t.height=this.$el.clientHeight,this.bounds=document.getElementById(this.boundsElementId).getBoundingClientRect(),this.scroll={left:document.getElementById(this.boundsElementId).scrollLeft,top:document.getElementById(this.boundsElementId).scrollTop}},drawCanvas:function(){var t=this,e=this.$el.getElementsByTagName("canvas")[0],n=e.getContext("2d");n.clearRect(0,0,e.width,e.height),this.connectionCards.forEach(function(e){t.drawConnection(n,e)})},drawConnection:function(t,e){var n=document.getElementById(e.members[0].rid),i=document.getElementById(e.members[1].rid);if(n&&i){var a=e.members[0],o=e.members[1],r=void 0,s=void 0,c=void 0,l=void 0;n.getBoundingClientRect().x<i.getBoundingClientRect().x?(r=n,s=i,c=a.states.selected||a.states.selectingConnected||a.states.connectingConnected,l=o.states.selected||o.states.selectingConnected||o.states.connectingConnected):(r=i,s=n,c=o.states.selected||o.states.selectingConnected||o.states.connectingConnected,l=a.states.selected||a.states.selectingConnected||a.states.connectingConnected);var d=r.getBoundingClientRect().x+r.getBoundingClientRect().width-this.bounds.x+this.scroll.left,u=r.getBoundingClientRect().y+r.getBoundingClientRect().height/2-this.bounds.y,f=s.getBoundingClientRect().x-this.bounds.x+this.scroll.left,m=s.getBoundingClientRect().y+s.getBoundingClientRect().height/2-this.bounds.y;t.lineWidth=5,t.strokeStyle="#ffff",t.fillStyle="#ffdc27";var h=15;"selectCard"!==this.userState.name&&"connectCard"!==this.userState.name||c&&l||(t.lineWidth=1,t.strokeStyle="#fff5",t.fillStyle="#ffdc2722",h=10),t.beginPath(),t.moveTo(d+5,u),t.lineTo(f-5,m),t.stroke(),t.beginPath(),t.arc(d,u,h,-Math.PI/2,Math.PI/2),t.fill(),t.beginPath(),t.arc(f,m,h,Math.PI/2,-Math.PI/2),t.fill()}}},created:function(){var t=this;v.$on(["cardRemoved","relationsUpdated"],function(){console.log("cards changed in way that might need redraw"),setTimeout(t.redraw,600)})},mounted:function(){this.$nextTick(this.firstDraw)},updated:function(){}},ut={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"Connections"},[e("canvas",{staticClass:"canvasConnection"})])}]};var ft={name:"Wall",components:{KedjaHeader:w,DropDown:d,Collections:lt,Connections:n("VU/8")(dt,ut,!1,function(t){n("n6IR")},"data-v-5de72938",null).exports,EditableInput:z},props:{rid:Number,wall:Object},computed:o()({collections:function(){return this.getWallCollections(this.wall)},relations:function(){return this.wall.relations},filterCards:{get:function(){return this.$store.state.filterCards},set:function(t){this.$store.commit("setFilterCards",t)}}},Object(r.e)("walls",["walls"]),Object(r.e)(["userState"]),Object(r.c)("walls",["getWallCollections"])),watch:{},methods:{getCollectionsFromAPI:function(){var t=this,e=this.$route.params.wallId;e&&g.get("walls/"+e+"/collections").then(function(e){t.$store.commit("setWallCollections",{wall:t.wall,collections:e.data})})},getConnectionsFromAPI:function(){var t=this,e=this.$route.params.wallId;e&&g.get("walls/"+e+"/relations").then(function(e){t.$store.commit("setWallConnections",{wall:t.wall,connections:e.data})})},getWallLocal:function(){this.wall=this.$store.getters.getActiveWall()},removeWall:function(){var t=this;g.delete("walls/"+this.rid).then(function(e){t.$router.push({name:"Walls"})})},updateTitle:function(t){g.put("walls/"+this.rid,{title:t})},connect:function(t){var e=this;console.log(t.members,this.wall),g.post("walls/"+this.rid+"/relations",t).then(function(t){console.log(t),e.wall.relations.push(t.data),e.$store.commit("forceUserStateUpdate")})},unconnect:function(t){var e=this;console.log(t.members);var n=this.wall.relations.find(function(e){return e.members.includes(t.members[0])&&e.members.includes(t.members[1])});g.delete("walls/"+this.rid+"/relations/"+n.relation_id).then(function(t){var i=e.wall.relations.indexOf(n);console.log(i),console.log(n.relation_id),console.log(e.wall.relations),-1!==i&&(e.wall.relations.splice(i,1),e.$store.commit("forceUserStateUpdate")),console.log(e.wall.relations)})},handleScroll:function(){this.$store.commit("setDirtyDraw")},collectionsMounted:function(){this.$refs.colls.addEventListener("scroll",this.handleScroll)}},created:function(){var t=this;v.$on("collectionCreated",function(){t.$nextTick(function(){document.activeElement.scrollIntoView({behavior:"smooth",inline:"start"})})}),v.$on("collectionRemoved",function(){t.$nextTick(function(){document.querySelector("#collections .horisontal-scroll-wrapper").scrollIntoView({behavior:"smooth",inline:"end"})})})},mounted:function(){},updated:function(){}},mt={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.wall?n("div",{staticClass:"Wall"},[n("div",{staticClass:"wallHeader"},[n("drop-down",{attrs:{items:[{label:"Radera vägg",f:t.removeWall}]}},[n("EditableInput",{attrs:{tag:"h2"},on:{change:function(e){return t.updateTitle(e)}},model:{value:t.wall.data.title,callback:function(e){t.$set(t.wall.data,"title",e)},expression:"wall.data.title"}}),t._v(" ▿\n    ")],1),t._v(" "),n("label",{on:{click:function(t){t.stopPropagation()}}},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.filterCards,expression:"filterCards"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.filterCards)?t._i(t.filterCards,null)>-1:t.filterCards},on:{change:function(e){var n=t.filterCards,i=e.target,a=!!i.checked;if(Array.isArray(n)){var o=t._i(n,null);i.checked?o<0&&(t.filterCards=n.concat([null])):o>-1&&(t.filterCards=n.slice(0,o).concat(n.slice(o+1)))}else t.filterCards=a}}}),t._v("\n      Filtrera kort i vald kedja\n    ")])],1),t._v(" "),n("div",{ref:"wallContent",staticClass:"wallContent"},[n("div",{ref:"colls",attrs:{id:"collections"}},[n("div",{staticClass:"horisontal-scroll-wrapper"},[n("collections",{attrs:{collections:t.collections,wall:t.wall,prid:t.rid},on:{connect:t.connect,unconnect:t.unconnect,mounted:t.collectionsMounted}}),t._v(" "),t.relations?n("connections",{staticClass:"connections",attrs:{connections:t.relations,boundsElementId:"collections"}}):t._e()],1)])]),t._v(" "),n("div",{staticClass:"wallFooter"})]):n("div",[t._v("\n  Loading....\n")])},staticRenderFns:[]};var ht=n("VU/8")(ft,mt,!1,function(t){n("QlhX")},"data-v-e1897360",null).exports,vt={name:"ContextMenuCard",components:{CardButton:Y},data:function(){return{}},props:{card:""},computed:{collection:function(){return this.$store.getters.getCollectionByCard(this.card)}},methods:{updateTitle:function(t){var e={endpoint:"collections/"+this.collection.rid+"/cards/"+this.card.rid,data:{title:this.card.data.title},method:"put",successCallback:function(t){console.log(t.data)}};this.$store.commit("makeAPICall",e)},removeCard:function(){var t=this,e={endpoint:"collections/"+this.collection.rid+"/cards/"+this.card.rid,method:"delete",successCallback:function(e){var n=t.collection.cards.indexOf(t.card);-1!==n&&(t.$store.commit("removeConnectionsByCardId",t.card.rid),t.collection.cards.splice(n,1))}};this.$store.commit("makeAPICall",e)}},mounted:function(){}},gt={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"ContextMenuCard"},[n("div",{staticClass:"header"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.card.data.title,expression:"card.data.title"}],staticClass:"h3",domProps:{value:t.card.data.title},on:{change:function(e){return t.updateTitle()},input:function(e){e.target.composing||t.$set(t.card.data,"title",e.target.value)}}}),t._v(" "),n("card-button",{nativeOn:{click:function(e){return t.removeCard()}}},[t._v("🗑️")])],1),t._v(" "),n("hr"),t._v(" "),n("h3",[t._v("\n    Beskrivning\n  ")]),t._v(" "),n("p",[t._v("(Kommande funktion)")]),t._v(" "),n("h3",[t._v("\n    Åtgärder\n  ")]),t._v(" "),n("p",[t._v("(Kommande funktion)")]),t._v(" "),n("h3",[t._v("Kommentarer")]),t._v(" "),n("p",[t._v("(Kommande funktion)")])])},staticRenderFns:[]};var pt={name:"ContextMenu",components:{ContextMenuCard:n("VU/8")(vt,gt,!1,function(t){n("yy44")},"data-v-008e2262",null).exports},data:function(){return{forceClose:!1}},props:{value:""},computed:o()({card:function(){if("selectCard"===this.userState.name)return this.cards(this.userState.data.rid)},hasContent:function(){return this.card}},Object(r.e)(["userState"]),Object(r.e)("walls/cards",["cards"])),watch:{hasContent:function(t){this.emitData(t)}},methods:{emitData:function(t){var e=!this.forceClose&&t;this.$emit("input",e)},toggleForceClose:function(){this.forceClose=!this.forceClose}},mounted:function(){}},Ct={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"ContextMenu",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"menuContent"},[this.card?e("div",[e("ContextMenuCard",{attrs:{card:this.card}})],1):this._e()])])},staticRenderFns:[]};var wt={name:"ViewWall",components:{KedjaHeader:w,Wall:ht,ContextMenu:n("VU/8")(pt,Ct,!1,function(t){n("ZJd7")},"data-v-4e2978a2",null).exports},data:function(){return{rid:NaN}},props:{},computed:o()({wall:function(){return this.rid&&this.walls[this.rid]}},Object(r.e)("walls",["walls"])),methods:o()({getWallFromParam:function(){this.rid=Number(this.$route.params.wallId),this.rid&&(this.fetchWall(this.rid),this.setActiveWallId(this.rid))},createCollection:function(){var t=this;g.post("walls/"+this.wall.rid+"/collections",{title:"Ny samling"}).then(function(e){console.log(e),t.wall.collections.push(e.data)})},resetUserState:function(){this.$store.commit("resetUserState")}},Object(r.d)("walls",["setActiveWallId"]),Object(r.b)("walls",["fetchWall"])),mounted:function(){this.getWallFromParam()}},bt={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"ViewWall",on:{click:this.resetUserState}},[e("kedja-header",[e("h3")]),this._v(" "),e("div",{staticClass:"content"},[this.rid?e("wall",{staticClass:"mywall",attrs:{rid:this.rid,wall:this.wall}}):this._e()],1)],1)},staticRenderFns:[]};var _t=n("VU/8")(wt,bt,!1,function(t){n("yr1/")},"data-v-50f96a56",null).exports;i.a.use(I.a);var kt=new I.a({mode:"history",routes:[{path:"/",redirect:"/login"},{path:"/login",name:"Login",component:W},{path:"/logging_in",name:"LoggingIn",component:A},{path:"/register",name:"Register",component:R},{path:"/home",name:"Home",component:$},{path:"/profile",name:"Profile",component:V},{path:"/walls",name:"Walls",component:P},{path:"/walls/:wallId",name:"ViewWall",component:_t}]}),yt=n("gRE1"),It=n.n(yt),Et=function(t,e){return t.find(function(t){return t.cardList.includes(e.rid)})},xt=function(t,e){var n=t.indexOf(e);return[t[n-1],t[n+1]].filter(function(t){return void 0!==t})},$t=function(t,e){return t.findIndex(function(t){return t.cardList.includes(e)})},Dt={namespaced:!0,modules:{collections:{namespaced:!0,state:{collections:{}},getters:{getCollectionByCard:function(t){return function(e){return It()(t.collections).find(function(t){return t.cardList.includes(e.rid)})}}},actions:{removeCard:function(t,e){var n=t.commit,i=t.getters.getCollectionByCard(e);g.delete("collections/"+i.rid+"/cards/"+e.rid).then(function(t){n("walls/removeCardRelations",e,{root:!0}),v.$emit("relationsUpdated"),n("removeCard",{collection:i,card:e}),n("walls/cards/removeCard",null,{root:!0}),n("resetUserState",null,{root:!0}),v.$emit("cardRemoved")})},createCardInCollection:function(t,e){var n=t.commit,i=e.collection,a=e.title;g.post("collections/"+i.rid+"/cards",{title:a}).then(function(t){n("walls/cards/setCard",t.data,{root:!0}),n("addCard",{collection:i,card:t.data}),v.$emit("cardCreated")})},createCollection:function(t,e){var n=t.commit;t.rootGetters;g.post("walls/"+e.rid+"/collections",{title:"Ny samling"}).then(function(t){n("setCollection",t.data),n("walls/addCollectionToWall",{wall:e,collection:t.data},{root:!0}),v.$emit("collectionCreated")})},removeCollection:function(t,e){var n=t.commit,i=e.wall,a=e.collection;g.delete("walls/"+i.rid+"/collections/"+a.rid).then(function(t){n("walls/removeCollectionFromWall",{wall:i,collection:a},{root:!0}),n("removeCollection",a),v.$emit("collectionRemoved")})}},mutations:{setCollections:function(t,e){e.forEach(function(e){t.collections[e.rid]?i.a.set(t.collections[e.rid],"data",e.data):i.a.set(t.collections,e.rid,e)})},addCard:function(t,e){var n=e.collection,i=e.card;n.cardList.push(i.rid)},setCollection:function(t,e){t.collections[e.rid]?i.a.set(t.collections[e.rid],"data",e.data):(e.cardList=e.cardList||[],i.a.set(t.collections,e.rid,e))},setCollectionIdCardList:function(t,e){var n=e.collectionId,a=e.cardList;i.a.set(t.collections[n],"cardList",a)},removeCollection:function(t,e){delete t.collections[e.rid]},removeCard:function(t,e){var n=e.collection,i=e.card;n.cardList.splice(n.cardList.indexOf(i.rid),1)}}},cards:{namespaced:!0,state:{cards:{}},getters:{getList:function(t){return function(e){return(e||[]).map(function(e){return t.cards[e]})}}},mutations:{setCard:function(t,e){e.states=e.states||{},i.a.set(t.cards,e.rid,e)},setCards:function(t,e){e.forEach(function(e){e.states=e.states||{},i.a.set(t.cards,e.rid,e)})},removeCard:function(t,e){delete t.cards[e]},setCardState:function(t,e){var n=e.rid,a=e.stateName,o=e.stateFlag;i.a.set(t.cards[n].states,a,o)},resetCardState:function(t,e){var n=e.rid,a=e.stateName;i.a.set(t.cards[n].states,a,void 0)},resetCardStates:function(t,e){var n=e.rid;i.a.set(t.cards[n],"states",{})}}}},state:{walls:{},wallList:[],activeWallId:NaN},getters:{all:function(t){return t.wallList.map(function(e){return t.walls[e]})},activeWall:function(t){return t.activeWallId&&t.walls[t.activeWallId]},getWallCollections:function(t){return function(e){return e&&e.collectionList&&e.collectionList.map(function(e){return t.collections.collections[e]})}},activeWallCollections:function(t,e){return e.getWallCollections(e.activeWall)},getCollectionCards:function(t){return function(e){return e.cardList.map(function(e){return t.cards.cards[e]})}},getClosestCardCousins:function(t,e){return function(t){var n=e.activeWallCollections,i=Et(n,t);return xt(n,i).reduce(function(t,n){return t.concat(e.getCollectionCards(n))},[])}},getRecursiveConnectionsByCardId:function(t,e){return function(t,n,i){var a=e.activeWallCollections;if(!t)return[];var o=[],r=[];t.filter(function(t){return t.members.includes(n)}).forEach(function(t){var e=$t(a,t.members[0]),s=$t(a,t.members[1])>e?1:0,c=+!t.members.indexOf(n);i===(s===c)&&(o.push(t.members[c]),r.push(t))});var s=[];return o.forEach(function(n){s=s.concat(e.getRecursiveConnectionsByCardId(t,n,i))}),r=r.concat(s)}},getDeepConnectionsByCardId:function(t,e){return function(t){var n=e.activeWall.relations,i=e.getRecursiveConnectionsByCardId(n,t,!0);return i=i.concat(e.getRecursiveConnectionsByCardId(n,t,!1))}},getDirectConnectionsByCardId:function(t,e){return function(t){return e.activeWall.relations.filter(function(e){return-1!==e.members.indexOf(t)})}}},actions:{fetchWalls:function(t){var e=t.commit;g.get("walls").then(function(t){e("setWalls",t.data)})},createWall:function(t){var e=t.commit;g.post("walls",{title:"Ny vägg"}).then(function(t){e("setWall",t.data)})},fetchWall:function(t,e){var n=t.commit;t.state;h.a.all([g.get("walls/"+e),g.get("walls/"+e+"/collections"),g.get("walls/"+e+"/relations")]).then(h.a.spread(function(t,e,i){t.data.collectionList=e.data.map(function(t){return t.rid}),n("setWall",t.data),n("collections/setCollections",e.data),h.a.all(e.data.map(function(t){return g.get("collections/"+t.rid+"/cards")})).then(h.a.spread(function(){for(var a=arguments.length,o=Array(a),r=0;r<a;r++)o[r]=arguments[r];o.forEach(function(t,i){n("cards/setCards",t.data),n("collections/setCollectionIdCardList",{collectionId:e.data[i].rid,cardList:t.data.map(function(t){return t.rid})})}),n("setRelationsData",{wall:t.data,relations:i.data})}))}))},createRelation:function(t,e){var n=t.commit,i=t.state,a=(e.wall,e.cards);g.post("walls/"+i.activeWallId+"/relations",{members:a.map(function(t){return t.rid})}).then(function(t){n("addRelation",{wallId:i.activeWallId,relation:t.data})})}},mutations:{setWalls:function(t,e){e.forEach(function(n){t.walls[n.rid]?i.a.set(t.walls[n.rid],"data",n.data):i.a.set(t.walls,n.rid,n),t.wallList=e.map(function(t){return t.rid})})},setActiveWallId:function(t,e){t.activeWallId=e},setWall:function(t,e){i.a.set(t.walls,e.rid,e),t.wallList.includes(e.rid)||t.wallList.push(e.rid)},removeCardRelations:function(t,e){It()(t.walls).forEach(function(t){t.relations.find(function(t){return t.members.includes(e.rid)})&&i.a.set(t,"relations",t.relations.filter(function(t){return!t.members.includes(e.rid)}))})},addRelation:function(t,e){var n=e.wall,i=e.relation;n.relations.push(i)},setRelationsData:function(t,e){var n=e.wall,a=e.relations;i.a.set(n,"relations",a)},addCollectionToWall:function(t,e){var n=e.wall,i=e.collection;n.collectionList.push(i.rid)},removeCollectionFromWall:function(t,e){var n=e.wall,i=e.collection;n.collectionList.splice(n.collectionList.indexOf(i.rid),1)}}},St=n("mvHQ"),Wt=n.n(St),Ut={namespaced:!0,state:{currentUserId:NaN,data:{}},mutations:{setCurrentUserId:function(t,e){t.currentUserId=e,e||delete localStorage.userData},setUserData:function(t,e){var n=e.data;n.fullName=[n.first_name,n.last_name].filter(function(t){return t}).join(" "),n.shortName=[n.first_name[0],n.last_name[0]].filter(function(t){return t}).join("").toUpperCase(),i.a.set(t.data,e.rid,n),e.rid===t.currentUserId&&(localStorage.userData=Wt()(e))},loadUserFromLocalStorage:function(t){if(localStorage.userData)try{var e=JSON.parse(localStorage.userData);t.currentUserId=e.rid,i.a.set(t.data,e.rid,e.data)}catch(t){console.log("Could not load userData",t)}}},getters:{currentUser:function(t){return t.data[t.currentUserId]}},actions:{fetchUserData:function(t,e){var n=t.commit;g.get("users/"+e).then(function(t){n("setUserData",t.data)})}}};i.a.use(r.a);var jt=new r.a.Store({modules:{walls:Dt,users:Ut},state:{env:{},walls:[],activeWallId:0,activeWall:"",connections:[],tabIndexCounter:0,connectionBounds:"",userState:{},auth:"",userid:"",userData:{},dirtyDraw:!0,filterCards:!1},mutations:{init:function(t,e){var n=e.env;i.a.set(t,"env",n),jt.commit("users/loadUserFromLocalStorage"),jt.commit("setDirtyDraw")},resetUserState:function(t){jt.commit("setUserState",{name:"default"})},setUserState:function(t,e){var n=e.name,a=e.data;jt.commit("setDirtyDraw"),i.a.set(t,"userState",{name:n,data:a||{},rand:Math.random()})},forceUserStateUpdate:function(t){jt.commit("setDirtyDraw"),t.userState.rand=Math.random()},setActiveWall:function(t,e){var n=e.wall;t.activeWall=n},setWallCollections:function(t,e){var n=e.wall,a=e.collections;i.a.set(n,"collections",a)},setWallConnections:function(t,e){var n=e.wall,a=e.connections;i.a.set(n,"connections",a)},setCollectionCards:function(t,e){var n=e.collection,a=e.cards;i.a.set(n,"cards",a)},setConnections:function(t,e){var n=e.connections;t.connections=n},initWall:function(t,e){i.a.set(e,"collections",[]),i.a.set(e,"connections",[]),i.a.set(e,"dirtyDraw",!1)},initCollection:function(t,e){i.a.set(e,"cards",[])},initConnection:function(t,e){i.a.set(e,"dirtyDraw",!1)},setDirtyDraw:function(t){i.a.set(t,"dirtyDraw",!0),i.a.nextTick().then(function(){i.a.set(t,"dirtyDraw",!1)})},setFilterCards:function(t,e){i.a.set(t,"filterCards",e)},setDeepConnectionsByCardId:function(t,e){var n=e.id;console.log("Set deep connections"),t.connections=jt.getters.getDeepConnectionsByCardId(n)},resetConnections:function(t){console.log("Reset connections"),t.connections=[],console.log(t.connections.length)},setCanConnectByCardId:function(t,e){var n=e.id,i=jt.getters.getCollectionByCardId(n);console.log(i);var a=jt.getters.getActiveWall(),o=jt.getters.getClosestArraySiblings(a.collections,i);console.log(o),o.forEach(function(t,e){t&&t.cards.forEach(function(t,e){jt.commit("setCardState",{card:t,stateName:"connectingCanConnect",stateFlag:!0})})})},removeConnectionsByCardId:function(t,e){var n=jt.getters["walls/activeWall"];console.log(n.relations),i.a.set(n,"relations",n.relations.filter(function(t){return!t.members.includes(e)})),console.log(n.relations),jt.commit("forceUserStateUpdate")}},actions:{authenticate:function(t){var e=t.dispatch;t.getters.isAuthenticated&&g.get("auth/valid").then(function(t){t.data.userid||e("logout")})},login:function(t,e){var n,i=t.commit;n=e.Authorization,localStorage.auth=n,g.defaults.headers.Authorization=n,i("users/setCurrentUserId",e.user.rid),i("users/setUserData",e.user)},logout:function(t){(0,t.commit)("users/setCurrentUserId",NaN)}},getters:{isAuthenticated:function(t){return!!t.users.currentUserId},userData:function(t){return t.users.data[t.users.currentUserId]},getCardById:function(t){return function(t){var e=void 0;return jt.getters.getActiveWall().collections.forEach(function(n,i){if(n.cards){var a=n.cards.find(function(e){return e.rid===t});a&&(e=a)}}),e}},getCardsByIds:function(t){return function(t){var e=[];return jt.getters.getActiveWall().collections.forEach(function(n,i){e=e.concat(n.cards.filter(function(e){return-1!==t.indexOf(e.rid)}))}),e}},getCardsByIdsInverted:function(t){return function(t){var e=[];return jt.getters.getActiveWall().collections.forEach(function(n,i){e=e.concat(n.cards.filter(function(e){return-1===t.indexOf(e.rid)}))}),e}},getCardsInverted:function(t){return function(t){var e=[];return jt.getters.getActiveWall().collections.forEach(function(n,i){e=e.concat(n.cards.filter(function(e){return-1===t.indexOf(e)}))}),e}},getClosestCardCousins:function(t){return function(t){var e=jt.getters.getCollectionByCard(t),n=jt.getters.getActiveWall(),i=[];return jt.getters.getClosestArraySiblings(n.collections,e).forEach(function(t,e){t&&(i=i.concat(t.cards))}),i}},getCollectionByCard:function(t){return function(t){return jt.getters.getActiveWall().collections.find(function(e){return-1!==e.cards.indexOf(t)})}},getCollectionArrayIdByCardId:function(t){return function(t){return jt.getters.getActiveWall().collections.findIndex(function(e){return e.cards.find(function(e){return e.rid===t})})}},getCardsByState:function(t){return function(t){var e=[];return jt.getters.getActiveWall().collections.forEach(function(n,i){e=e.concat(n.cards.filter(function(e){return e.states[t]}))}),e}},getDirectConnectionsByCardId:function(t){return function(t){var e=jt.getters.getActiveWall();return e.connections?e.connections.filter(function(e){return-1!==e.members.indexOf(t)}):[]}},getDeepConnectionsByCardId:function(t){return function(t){var e=jt.getters.getActiveWall().connections,n=jt.getters.getRecursiveConnectionsByCardId(e,t,!0);return n=n.concat(jt.getters.getRecursiveConnectionsByCardId(e,t,!1))}},getRecursiveConnectionsByCardId:function(t){return function(t,e,n){if(!t)return[];var i=[],a=[];t.filter(function(t){return-1!==t.members.indexOf(e)}).forEach(function(t){var o=jt.getters.getCollectionArrayIdByCardId(t.members[0]),r=jt.getters.getCollectionArrayIdByCardId(t.members[1])>o?1:0,s=+!t.members.indexOf(e);n===(r===s)&&(i.push(t.members[s]),a.push(t))});var o=[];return i.forEach(function(e){o=o.concat(jt.getters.getRecursiveConnectionsByCardId(t,e,n))}),a=a.concat(o)}},getClosestArraySiblings:function(t){return function(t,e){if(!t)return[];var n=[void 0,void 0],i=t.indexOf(e);return i>0&&(n[0]=t[i-1]),i<t.length-1&&(n[1]=t[i+1]),n}},getTreeById:function(t){return function(t){}},getWalls:function(t){return function(){return t.walls}}}});i.a.config.productionTip=!1,new i.a({el:"#app",router:kt,store:jt,components:{App:y},template:"<App/>"})},NtAT:function(t,e){},QlhX:function(t,e){},SPHx:function(t,e){},Sk8g:function(t,e){},UYur:function(t,e){},ZJd7:function(t,e){},ZJjC:function(t,e){},fWSD:function(t,e){},"n+6D":function(t,e){},n6IR:function(t,e){},p4Ut:function(t,e){},v0MC:function(t,e){},"yr1/":function(t,e){},yy44:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.297697f2198ab060e0a9.js.map